# 上文回顾

[上节](https://www.cnblogs.com/zhangpan1244/p/11925921.html) 实现了商品详情业务的功能，以及一个商品的好评度，同时给大家讲述了在使用`@Transactional` 事务的时候，添加`Propagation.SUPPORTS`和不添加该传播机制的差异性，本节来实现电商中最常用也是必不可少的功能点：`购物车`。

# 需求分析

使用过电商平台的同学都知道，它有一个特别实用的功能就是：我们在浏览商品的时候，发现我们喜欢或者中意的商品之后有2种方法来进行记录：`添加收藏`和`添加购物车`。本系列实现中，我们不实现`添加收藏`选项，有兴趣的同学可以自行扩展。

还是使用`jd`做示例： 

![9-1](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1574824882713.png)

可以看到，这里在添加购物车的时候，用户并没有进行登录，说明我们的购物车最少分为2种情况。

- 一种就像上述我们看到的，未登录添加购物车之后，在上面展示了一个`立刻登录`按钮，如果用户要进行购买结算，那么就会跳转到登录界面，一旦用户登录成功之后，就会生成`下节`我们要做的`订单`信息。
- 另一种是用户登录之后，添加购物车，那么这一部分的数据会跟随用户在登录而自动同步到云端服务器，以方便用户在切换手机、电脑等等终端之后，可以保证能看到相同的数据。

接下来，我们来具体分析我们要开发一个购物车，都要实现哪些功能信息。

# 购物车

## 开发梳理
购物车具体包含有哪些内容呢，我们来看看上图[9-1]中都包含有哪些元素？

- 商品图片
- 商品价格
- 名称
- 款式（SKU/规格）
- 数量
- 操作

如我们上述所说的，购物车的实现最少包含2种场景，一种登录/一种未登录。在未登录状态下，我们来看一下`jd`是如何实现的？

在图[9-1]中，我们为购物车加入了2件商品，我们可以在网站中点来点去，再回到购物车发现商品依然存在，那么它是怎么做到的呢？在当前页面点击`F12`，如图[9-2]  

![9-2](https://i.loli.net/2019/11/27/bqa51wnSxzZe23E.png)

选择`Application -> Cookies -> cart.jd.com`,可以看到自动生成了一个随机的`user-key`,如何我们给购物车中添加2件商品之后，会额外多出一个`cookie -> cart-main`,我们删除这两个cookie后刷新页面就会发现，当前购物车中的商品被清空了。

一旦我们登录系统之后，会进行一次后台请求，这个请求是一次购物车同步的过程，会把当前购物车中的数据与云端购物车数据进行合并。

我们的实现和它类似，只不过我们不会这么麻烦，如果未登录不会生成user-key,我们直接将数据存储在当前浏览器的名为`shopcart`的cookie中。

## 编码实现

搞清楚实现逻辑之后，我们就可以开始进行我们的编码实现了，首先我们要做的是将商品存储在浏览器cookie中，这一步我们可以交给前端实现，也可以在后端实现。（还是建议后端同学学习一下，不要张嘴闭嘴前后端分离，分离是公司的事，技术是自己的本事）

### DTO实现

### Custom Mapper实现

### Service实现

### Controller实现

### Test API

# 福利讲解
# 源码下载

[Github 传送门](https://github.com/Isaac-Zhang/expensive-shop)  
[Gitee 传送门](https://gitee.com/IsaacZhang/expensive-shop)

# 下节预告

下一节我们将继续开发商品详情展示以及商品评价业务，在过程中使用到的任何开发组件，我都会通过专门的一节来进行介绍的，兄弟们末慌！

gogogo！